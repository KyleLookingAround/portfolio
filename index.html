<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Gigs & Festivals Tracker</title>
  <style>
    /* Keep your existing styling and dark mode CSS variables here */
    /* ... */
  </style>
</head>
<body>
  <div class="container">
    <div class="toggle-container">
      <label class="toggle-switch">
        <input type="checkbox" id="dark-mode-toggle">
        <span class="slider"></span>
      </label>
    </div>
    <h1>Gigs & Festivals Tracker</h1>

    <form id="entry-form">
      <select id="entry-type" required>
        <option value="" disabled selected>Select Type</option>
        <option value="gig">Gig</option>
        <option value="festival">Festival</option>
      </select>
      <input type="text" id="entry-name" placeholder="Name" required />
      <input type="text" id="entry-location" placeholder="Location" required />
      <input type="date" id="entry-date" required />

      <!-- Gig rating field -->
      <select id="gig-rating">
        <option value="" disabled selected>Gig Rating</option>
        <option value="⭐">⭐</option>
        <option value="⭐⭐">⭐⭐</option>
        <option value="⭐⭐⭐">⭐⭐⭐</option>
        <option value="⭐⭐⭐⭐">⭐⭐⭐⭐</option>
        <option value="⭐⭐⭐⭐⭐">⭐⭐⭐⭐⭐</option>
      </select>

      <!-- Festival rating field -->
      <select id="festival-rating" style="display: none;">
        <option value="" disabled selected>Festival Rating</option>
        <option value="⭐">⭐</option>
        <option value="⭐⭐">⭐⭐</option>
        <option value="⭐⭐⭐">⭐⭐⭐</option>
        <option value="⭐⭐⭐⭐">⭐⭐⭐⭐</option>
        <option value="⭐⭐⭐⭐⭐">⭐⭐⭐⭐⭐</option>
      </select>

      <button type="submit">Add Entry</button>
    </form>

    <div class="gigs-section">
      <h2>Gigs</h2>
      <div id="gigs-list"></div>
    </div>

    <div class="festivals-section">
      <h2>Festivals</h2>
      <div id="festivals-list"></div>
    </div>

    <button class="export-btn" id="export-btn">Export Gigs & Festivals</button>
  </div>

  <!-- Modals for support acts and festival artists -->
  <div id="support-modal" class="modal">
    <div class="modal-content">
      <span class="close" id="close-support-modal">&times;</span>
      <h3>Add Support Act</h3>
      <form id="support-act-form">
        <input type="text" id="support-act-name" placeholder="Support Act Name" required />
        <select id="support-act-rating" required>
          <option value="" disabled selected>Rating</option>
          <option value="⭐">⭐</option>
          <option value="⭐⭐">⭐⭐</option>
          <option value="⭐⭐⭐">⭐⭐⭐</option>
          <option value="⭐⭐⭐⭐">⭐⭐⭐⭐</option>
          <option value="⭐⭐⭐⭐⭐">⭐⭐⭐⭐⭐</option>
        </select>
        <button type="submit">Add Support Act</button>
      </form>
    </div>
  </div>

  <div id="artist-modal" class="modal">
    <div class="modal-content">
      <span class="close" id="close-artist-modal">&times;</span>
      <h3>Add Artist</h3>
      <form id="artist-form">
        <input type="text" id="artist-name" placeholder="Artist Name" required />
        <select id="artist-rating" required>
          <option value="" disabled selected>Rating</option>
          <option value="⭐">⭐</option>
          <option value="⭐⭐">⭐⭐</option>
          <option value="⭐⭐⭐">⭐⭐⭐</option>
          <option value="⭐⭐⭐⭐">⭐⭐⭐⭐</option>
          <option value="⭐⭐⭐⭐⭐">⭐⭐⭐⭐⭐</option>
        </select>
        <button type="submit">Add Artist</button>
      </form>
    </div>
  </div>

  <script>
    // ==== State & DOM references ====
    let gigs = JSON.parse(localStorage.getItem('gigs')) || [];
    let festivals = JSON.parse(localStorage.getItem('festivals')) || [];
    let isDarkMode = JSON.parse(localStorage.getItem('darkMode')) || false;
    let currentEditingEntryId = null; // For adding support acts/artists

    const entryForm = document.getElementById('entry-form');
    const entryType = document.getElementById('entry-type');
    const entryName = document.getElementById('entry-name');
    const entryLocation = document.getElementById('entry-location');
    const entryDate = document.getElementById('entry-date');
    const gigRating = document.getElementById('gig-rating');
    const festivalRating = document.getElementById('festival-rating');
    const gigsList = document.getElementById('gigs-list');
    const festivalsList = document.getElementById('festivals-list');
    const exportBtn = document.getElementById('export-btn');
    const darkModeToggle = document.getElementById('dark-mode-toggle');

    const supportModal = document.getElementById('support-modal');
    const closeSupportModal = document.getElementById('close-support-modal');
    const supportActForm = document.getElementById('support-act-form');
    const supportActName = document.getElementById('support-act-name');
    const supportActRating = document.getElementById('support-act-rating');

    const artistModal = document.getElementById('artist-modal');
    const closeArtistModal = document.getElementById('close-artist-modal');
    const artistForm = document.getElementById('artist-form');
    const artistName = document.getElementById('artist-name');
    const artistRatingElement = document.getElementById('artist-rating');

    // ==== Utility / Helper Functions ====
    function saveData() {
      localStorage.setItem('gigs', JSON.stringify(gigs));
      localStorage.setItem('festivals', JSON.stringify(festivals));
      localStorage.setItem('darkMode', JSON.stringify(isDarkMode));
    }

    function applyTheme() {
      if (isDarkMode) {
        document.body.classList.add('dark-mode');
        darkModeToggle.checked = true;
      } else {
        document.body.classList.remove('dark-mode');
        darkModeToggle.checked = false;
      }
    }

    function createButton(text, onClick, bgColor) {
      const btn = document.createElement('button');
      btn.textContent = text;
      btn.style.backgroundColor = bgColor || 'var(--primary-color)';
      btn.style.color = 'var(--button-text-color)';
      btn.style.border = 'none';
      btn.style.padding = '5px 10px';
      btn.style.borderRadius = '4px';
      btn.style.cursor = 'pointer';
      btn.style.marginRight = '5px';
      btn.style.transition = 'background-color 0.3s';
      btn.addEventListener('click', onClick);
      return btn;
    }

    // ==== Rendering Functions ====
    function renderEntries() {
      renderGigs();
      renderFestivals();
    }

    function renderGigs() {
      gigsList.innerHTML = '';
      gigs.sort((a, b) => new Date(a.date) - new Date(b.date));
      gigs.forEach(gig => {
        gigsList.appendChild(createGigElement(gig));
      });
    }

    function renderFestivals() {
      festivalsList.innerHTML = '';
      festivals.sort((a, b) => new Date(a.date) - new Date(b.date));
      festivals.forEach(festival => {
        festivalsList.appendChild(createFestivalElement(festival));
      });
    }

    function createGigElement(gig) {
      const gigDiv = document.createElement('div');
      gigDiv.classList.add('gig');

      const infoDiv = document.createElement('div');
      infoDiv.innerHTML = `
        <strong>${gig.name}</strong><br>
        Location: ${gig.location}<br>
        Date: ${new Date(gig.date).toLocaleDateString()}<br>
        Rating: <span class="rating">${gig.rating}</span>
      `;

      if (gig.supportActs && gig.supportActs.length > 0) {
        const supportActsDiv = document.createElement('div');
        supportActsDiv.innerHTML = `<em>Support Acts:</em>`;
        const ul = document.createElement('ul');
        gig.supportActs.forEach(act => {
          const li = document.createElement('li');
          li.textContent = `${act.name} - ${act.rating}`;
          ul.appendChild(li);
        });
        supportActsDiv.appendChild(ul);
        infoDiv.appendChild(supportActsDiv);
      }

      const buttonsDiv = document.createElement('div');
      const addSupportBtn = createButton('Add Support Act', () => {
        currentEditingEntryId = gig.id;
        openSupportModal();
      });
      const deleteBtn = createButton('Delete', () => {
        if (confirm('Are you sure you want to delete this gig?')) {
          gigs = gigs.filter(item => item.id !== gig.id);
          saveData();
          renderEntries();
        }
      }, 'var(--danger-color)');

      buttonsDiv.appendChild(addSupportBtn);
      buttonsDiv.appendChild(deleteBtn);
      infoDiv.appendChild(buttonsDiv);

      gigDiv.appendChild(infoDiv);
      return gigDiv;
    }

    function createFestivalElement(festival) {
      const festivalDiv = document.createElement('div');
      festivalDiv.classList.add('festival');

      const infoDiv = document.createElement('div');
      infoDiv.innerHTML = `
        <strong>${festival.name}</strong><br>
        Location: ${festival.location}<br>
        Date: ${new Date(festival.date).toLocaleDateString()}<br>
        Overall Rating: <span class="rating">${festival.rating}</span>
      `;

      if (festival.artists && festival.artists.length > 0) {
        const artistsDiv = document.createElement('div');
        artistsDiv.innerHTML = `<em>Artists Seen:</em>`;
        const ul = document.createElement('ul');
        festival.artists.forEach(ar => {
          const li = document.createElement('li');
          li.textContent = `${ar.name} - ${ar.rating}`;
          ul.appendChild(li);
        });
        artistsDiv.appendChild(ul);
        infoDiv.appendChild(artistsDiv);
      }

      const buttonsDiv = document.createElement('div');
      const addArtistBtn = createButton('Add Artist', () => {
        currentEditingEntryId = festival.id;
        openArtistModal();
      });
      const deleteBtn = createButton('Delete', () => {
        if (confirm('Are you sure you want to delete this festival?')) {
          festivals = festivals.filter(item => item.id !== festival.id);
          saveData();
          renderEntries();
        }
      }, 'var(--danger-color)');

      buttonsDiv.appendChild(addArtistBtn);
      buttonsDiv.appendChild(deleteBtn);
      infoDiv.appendChild(buttonsDiv);

      festivalDiv.appendChild(infoDiv);
      return festivalDiv;
    }

    // ==== Add Entry Logic ====
    function addGig(name, location, date, rating) {
      const newGig = {
        id: Date.now(),
        name,
        location,
        date,
        rating,
        supportActs: []
      };
      gigs.push(newGig);
      saveData();
      renderEntries();
    }

    function addFestival(name, location, date, rating) {
      const newFestival = {
        id: Date.now(),
        name,
        location,
        date,
        rating,
        artists: []
      };
      festivals.push(newFestival);
      saveData();
      renderEntries();
    }

    entryType.addEventListener('change', () => {
      if (entryType.value === 'gig') {
        gigRating.style.display = 'block';
        festivalRating.style.display = 'none';
        gigRating.setAttribute('required', 'required');
        festivalRating.removeAttribute('required');
      } else {
        festivalRating.style.display = 'block';
        gigRating.style.display = 'none';
        festivalRating.setAttribute('required', 'required');
        gigRating.removeAttribute('required');
      }
    });

    entryForm.addEventListener('submit', (e) => {
      e.preventDefault();
      const type = entryType.value;
      const name = entryName.value.trim();
      const location = entryLocation.value.trim();
      const date = entryDate.value;

      let rating = '';
      if (type === 'gig') {
        rating = gigRating.value;
      } else if (type === 'festival') {
        rating = festivalRating.value;
      }

      if (!type || !name || !location || !date || !rating) {
        alert('Please fill in all required fields and rating appropriately.');
        return;
      }

      if (type === 'gig') {
        addGig(name, location, date, rating);
      } else {
        addFestival(name, location, date, rating);
      }

      entryForm.reset();
      // Reset UI for rating fields
      festivalRating.style.display = 'none';
      gigRating.style.display = 'block';
      gigRating.setAttribute('required', 'required');
      festivalRating.removeAttribute('required');
    });

    // ==== Support Acts and Artists Modals ====
    function openSupportModal() {
      supportModal.style.display = 'block';
    }

    function closeSupportModalFunc() {
      supportModal.style.display = 'none';
      supportActForm.reset();
    }

    function openArtistModal() {
      artistModal.style.display = 'block';
    }

    function closeArtistModalFunc() {
      artistModal.style.display = 'none';
      artistForm.reset();
    }

    closeSupportModal.onclick = closeSupportModalFunc;
    closeArtistModal.onclick = closeArtistModalFunc;

    window.onclick = function(event) {
      if (event.target == supportModal) {
        closeSupportModalFunc();
      }
      if (event.target == artistModal) {
        closeArtistModalFunc();
      }
    };

    supportActForm.addEventListener('submit', (e) => {
      e.preventDefault();
      const actNameVal = supportActName.value.trim();
      const actRatingVal = supportActRating.value;
      if (!actNameVal || !actRatingVal) {
        alert('Please fill in all fields for the support act.');
        return;
      }

      const gigIndex = gigs.findIndex(g => g.id === currentEditingEntryId);
      if (gigIndex !== -1) {
        gigs[gigIndex].supportActs.push({
          name: actNameVal,
          rating: actRatingVal
        });
        saveData();
        renderEntries();
      }

      closeSupportModalFunc();
    });

    artistForm.addEventListener('submit', (e) => {
      e.preventDefault();
      const artistNameVal = artistName.value.trim();
      const artistRatingVal = artistRatingElement.value;

      if (!artistNameVal || !artistRatingVal) {
        alert('Please fill in all fields for the artist.');
        return;
      }

      const festivalIndex = festivals.findIndex(f => f.id === currentEditingEntryId);
      if (festivalIndex !== -1) {
        festivals[festivalIndex].artists.push({
          name: artistNameVal,
          rating: artistRatingVal
        });
        saveData();
        renderEntries();
      }

      closeArtistModalFunc();
    });

    // ==== Export Logic ====
    exportBtn.addEventListener('click', () => {
      if (gigs.length === 0 && festivals.length === 0) {
        alert('No gigs or festivals to export.');
        return;
      }

      const today = new Date().setHours(0,0,0,0);
      const upcomingGigs = gigs.filter(g => new Date(g.date).setHours(0,0,0,0) >= today);
      const pastGigs = gigs.filter(g => new Date(g.date).setHours(0,0,0,0) < today);
      const upcomingFestivals = festivals.filter(f => new Date(f.date).setHours(0,0,0,0) >= today);
      const pastFestivals = festivals.filter(f => new Date(f.date).setHours(0,0,0,0) < today);

      let exportText = `🎵 *My Gigs & Festivals*\n\n`;

      if (upcomingGigs.length > 0) {
        exportText += `🔜 *Upcoming Gigs:*\n`;
        upcomingGigs.forEach(gig => {
          exportText += `🎤 ${gig.name}\n📍 ${gig.location}\n📅 ${new Date(gig.date).toLocaleDateString()}\n⭐ Rating: ${gig.rating}\n`;
          if (gig.supportActs.length > 0) {
            exportText += `   🎶 Support Acts:\n`;
            gig.supportActs.forEach(act => {
              exportText += `      - ${act.name} (${act.rating})\n`;
            });
          }
          exportText += `\n`;
        });
      }

      if (pastGigs.length > 0) {
        exportText += `🔙 *Past Gigs:*\n`;
        pastGigs.forEach(gig => {
          exportText += `🎤 ${gig.name}\n📍 ${gig.location}\n📅 ${new Date(gig.date).toLocaleDateString()}\n⭐ Rating: ${gig.rating}\n`;
          if (gig.supportActs.length > 0) {
            exportText += `   🎶 Support Acts:\n`;
            gig.supportActs.forEach(act => {
              exportText += `      - ${act.name} (${act.rating})\n`;
            });
          }
          exportText += `\n`;
        });
      }

      if (upcomingFestivals.length > 0) {
        exportText += `🔜 *Upcoming Festivals:*\n`;
        upcomingFestivals.forEach(fest => {
          exportText += `🎪 ${fest.name}\n📍 ${fest.location}\n📅 ${new Date(fest.date).toLocaleDateString()}\n⭐ Overall Rating: ${fest.rating}\n`;
          if (fest.artists.length > 0) {
            exportText += `   🎶 Artists Seen:\n`;
            fest.artists.forEach(ar => {
              exportText += `      - ${ar.name} (${ar.rating})\n`;
            });
          }
          exportText += `\n`;
        });
      }

      if (pastFestivals.length > 0) {
        exportText += `🔙 *Past Festivals:*\n`;
        pastFestivals.forEach(fest => {
          exportText += `🎪 ${fest.name}\n📍 ${fest.location}\n📅 ${new Date(fest.date).toLocaleDateString()}\n⭐ Overall Rating: ${fest.rating}\n`;
          if (fest.artists.length > 0) {
            exportText += `   🎶 Artists Seen:\n`;
            fest.artists.forEach(ar => {
              exportText += `      - ${ar.name} (${ar.rating})\n`;
            });
          }
          exportText += `\n`;
        });
      }

      const tempTextarea = document.createElement('textarea');
      tempTextarea.value = exportText;
      document.body.appendChild(tempTextarea);
      tempTextarea.select();
      document.execCommand('copy');
      document.body.removeChild(tempTextarea);

      alert('Gigs and Festivals exported to clipboard!');
    });

    // ==== Dark Mode ====
    darkModeToggle.addEventListener('change', () => {
      isDarkMode = darkModeToggle.checked;
      applyTheme();
      saveData();
    });

    // Initial setup
    applyTheme();
    renderEntries();
  </script>
</body>
</html>
